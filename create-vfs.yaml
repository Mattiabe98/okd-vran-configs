apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  name: 99-create-vfs
  labels:
    machineconfiguration.openshift.io/role: master
spec:
  config:
    ignition:
      version: 3.4.0
    systemd:
      units:
      - name: create-vfs.service
        enabled: true
        contents: |
          [Unit]
          Description=Create VFs for ens2f2 and ens2f1
          Requires=network-online.target load-intel-drivers.service
          After=network-online.target load-intel-drivers.service

          [Service]
          Type=oneshot
          RemainAfterExit=true
          ExecStart=/usr/local/bin/create-vfs.sh

          [Install]
          WantedBy=multi-user.target
    storage:
      files:
        - path: /usr/local/bin/create-vfs.sh
          contents:
            source: data:text/plain;base64,IyEvYmluL2Jhc2gKIyBDcmVhdGUgVkZzCgojIEluaXRpYWxpemUgZW5zMmYyIFZGCmZvciBpIGluIHsxLi4xMH07IGRvCiAgaWYgW1sgLWUgL3N5cy9jbGFzcy9uZXQvZW5zMmYyIF1dOyB0aGVuCiAgICBlY2hvIDggPiAvc3lzL2NsYXNzL25ldC9lbnMyZjIvZGV2aWNlL3NyaW92X251bXZmcwogICAgYnJlYWsKICBmaQogIGVjaG8gIldhaXRpbmcgZm9yIGVuczJmMiB0byBhcHBlYXIuLi4iCiAgc2xlZXAgMQpkb25lCgojIEluaXRpYWxpemUgZW5zMmYxIFZGCmZvciBpIGluIHsxLi4xMH07IGRvCiAgaWYgW1sgLWUgL3N5cy9jbGFzcy9uZXQvZW5zMmYxIF1dOyB0aGVuCiAgICBlY2hvIDkgPiAvc3lzL2NsYXNzL25ldC9lbnMyZjEvZGV2aWNlL3NyaW92X251bXZmcwogICAgYnJlYWsKICBmaQogIGVjaG8gIldhaXRpbmcgZm9yIGVuczJmMSB0byBhcHBlYXIuLi4iCiAgc2xlZXAgMQpkb25lCgojIFdhaXQgZm9yIGVuczJmMiBWRiBpbnRlcmZhY2VzIHRvIGJlIGNyZWF0ZWQKZm9yIGkgaW4gezEuLjEwfTsgZG8KICBpZiBpcCBsaW5rIHNob3cgZW5zMmYydjAgJiYgaXAgbGluayBzaG93IGVuczJmMnYxOyB0aGVuCiAgICBicmVhawogIGZpCiAgZWNobyAiV2FpdGluZyBmb3IgVkZzIGVuczJmMnYwIGFuZCBlbnMyZjJ2MS4uLiIKICBzbGVlcCAxCmRvbmUKCiMgREhDUCArIE0tUGxhbmUKaXAgbGluayBzZXQgZW5zMmYyIHZmIDEgbWFjIDAwOjFEOkFDOjAwOjAwOjAxIHZsYW4gMAojIERIQ1AgKyBNLVBsYW5lIElQIHNldHVwCmlwIGxpbmsgc2V0IGVuczJmMnYxIHVwCmlwIGFkZHIgYWRkIDEwLjIyLjE3LjE1NS8zMiBkZXYgZW5zMmYydjEKCiMjIyMjIyMjIyMjIyMjIyBPLVJVIDEgU0VUVVAgIyMjIyMjIyMjIyMjIyMjIyMKCiMgRFUwIC0gTy1SVSAxCmlwIGxpbmsgc2V0IGVuczJmMiB2ZiAwIG1hYyA3MjowZTo5Yjo1Zjo4MTplMCB2bGFuIDAKCiMgQ1UwCmlwIGxpbmsgc2V0IGVuczJmMiB2ZiAyIG1hYyAwMDoxRDpBQzowMDoxMDowMSB2bGFuIDAKIyBEVTAgLSBDVTAKaXAgbGluayBzZXQgZW5zMmYyIHZmIDMgbWFjIDAwOjFEOkFDOjAwOjEwOjAyIHZsYW4gMAoKIyBEVTEgLSBPLVJVIDEKaXAgbGluayBzZXQgZW5zMmYyIHZmIDQgbWFjIDcyOjBlOjliOjVmOjgxOmUwIHZsYW4gMAojIERVMSAtIENVMAppcCBsaW5rIHNldCBlbnMyZjIgdmYgNSBtYWMgMDA6MUQ6QUM6MDA6MTA6MDMgdmxhbiAwCgojIERVMiAtIE8tUlUgMQppcCBsaW5rIHNldCBlbnMyZjIgdmYgNiBtYWMgNzI6MGU6OWI6NWY6ODE6ZTAgdmxhbiAwCiMgRFUyIC0gQ1UwCmlwIGxpbmsgc2V0IGVuczJmMiB2ZiA3IG1hYyAwMDoxRDpBQzowMDoxMDowNCB2bGFuIDAKCiMgTWlzYwppcCBsaW5rIHNldCBlbnMyZjIgdmYgMCBzcG9vZmNoayBvZmYKaXAgbGluayBzZXQgZW5zMmYydjAgbXR1IDkwMDAKaXAgbGluayBzZXQgZW5zMmYyIHZmIDQgc3Bvb2ZjaGsgb2ZmCmlwIGxpbmsgc2V0IGVuczJmMnY0IG10dSA5MDAwCmlwIGxpbmsgc2V0IGVuczJmMiB2ZiA2IHNwb29mY2hrIG9mZgppcCBsaW5rIHNldCBlbnMyZjJ2NiBtdHUgOTAwMAppcCBsaW5rIHNldCBlbnMyZjJ2MiBtdHUgOTAwMAppcCBsaW5rIHNldCBlbnMyZjJ2MyBtdHUgOTAwMAppcCBsaW5rIHNldCBlbnMyZjJ2NSBtdHUgOTAwMAppcCBsaW5rIHNldCBlbnMyZjJ2NyBtdHUgOTAwMAoKIyMjIyMjIyMjIyMjIyMjIE8tUlUgMCBTRVRVUCAjIyMjIyMjIyMjIyMjIyMjIwoKIyBXYWl0IGZvciBlbnMyZjEgVkYgaW50ZXJmYWNlcyB0byBiZSBjcmVhdGVkCmZvciBpIGluIHsxLi4xMH07IGRvCiAgaWYgaXAgbGluayBzaG93IGVuczJmMXYwICYmIGlwIGxpbmsgc2hvdyBlbnMyZjF2MTsgdGhlbgogICAgYnJlYWsKICBmaQogIGVjaG8gIldhaXRpbmcgZm9yIFZGcyBlbnMyZjF2MCBhbmQgZW5zMmYxdjEuLi4iCiAgc2xlZXAgMQpkb25lCgojIERVMyAtIE8tUlUgMAppcCBsaW5rIHNldCBlbnMyZjEgdmYgMCBtYWMgNzI6MGU6OWI6NWY6ODE6ZTEgdmxhbiAwCiMgRFUzIC0gQ1UwCmlwIGxpbmsgc2V0IGVuczJmMSB2ZiAxIG1hYyAwMDoxRDpBQzowMDoxMDowNQoKIyBEVTQgLSBPLVJVIDAKaXAgbGluayBzZXQgZW5zMmYxIHZmIDIgbWFjIDcyOjBlOjliOjVmOjgxOmUxIHZsYW4gMAojIERVNCAtIENVMAppcCBsaW5rIHNldCBlbnMyZjEgdmYgMyBtYWMgMDA6MUQ6QUM6MDA6MTA6MDYKCiMgRFU1IC0gTy1SVSAwCmlwIGxpbmsgc2V0IGVuczJmMSB2ZiA0IG1hYyA3MjowZTo5Yjo1Zjo4MTplMSB2bGFuIDAKIyBEVTUgLSBDVTAKaXAgbGluayBzZXQgZW5zMmYxIHZmIDUgbWFjIDAwOjFEOkFDOjAwOjEwOjA3CgojIE1pc2MKaXAgbGluayBzZXQgZW5zMmYxIHZmIDAgc3Bvb2ZjaGsgb2ZmCmlwIGxpbmsgc2V0IGVuczJmMXYwIG10dSA5MDAwCmlwIGxpbmsgc2V0IGVuczJmMSB2ZiAyIHNwb29mY2hrIG9mZgppcCBsaW5rIHNldCBlbnMyZjF2MiBtdHUgOTAwMAppcCBsaW5rIHNldCBlbnMyZjEgdmYgNCBzcG9vZmNoayBvZmYKaXAgbGluayBzZXQgZW5zMmYxdjQgbXR1IDkwMDAKaXAgbGluayBzZXQgZW5zMmYxdjEgbXR1IDkwMDAKaXAgbGluayBzZXQgZW5zMmYxdjMgbXR1IDkwMDAKaXAgbGluayBzZXQgZW5zMmYxdjUgbXR1IDkwMDAKCiMgTmV3IFZGIGZvciB0cmliYW5kCiMgQ1UgVHJpYmFuZAppcCBsaW5rIHNldCBlbnMyZjEgdmYgNiBtYWMgMDA6MUQ6QUM6MDA6MTE6MDAgdmxhbiAwCiMgRFUgVHJpYmFuZCAtIE8tUlUgVHJpYmFuZAppcCBsaW5rIHNldCBlbnMyZjEgdmYgNyBtYWMgNzI6MGU6OWI6NWY6ODI6ZTAgdmxhbiAwCiMgRFUgVHJpYmFuZCAtIENVIFRyaWJhbmQKaXAgbGluayBzZXQgZW5zMmYxIHZmIDggbWFjIDAwOjFEOkFDOjAwOjExOjAxIHZsYW4gMAoKIyBNaXNjCmlwIGxpbmsgc2V0IGVuczJmMSB2ZiA3IHNwb29mY2hrIG9mZgppcCBsaW5rIHNldCBlbnMyZjF2NyBtdHUgOTAwMAo=
          mode: 0755
